<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°å­˜å‚¨æµ‹è¯• - å››æ—¶</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5dc;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #60281E;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4a1f17;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: #f0f0f0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æœ¬åœ°å­˜å‚¨åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1: ç¯å¢ƒæ£€æµ‹</h2>
        <button onclick="testEnvironment()">æ£€æµ‹å½“å‰ç¯å¢ƒ</button>
        <div id="envResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•2: æ¨¡æ‹Ÿç­›é€‰æ¡ä»¶</h2>
        <button onclick="testFilters()">æ¨¡æ‹Ÿä¿å­˜ç­›é€‰æ¡ä»¶</button>
        <div id="filterResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•3: ç”Ÿæˆæœ¬åœ°èœè°±</h2>
        <button onclick="testLocalRecipes()">ç”Ÿæˆæœ¬åœ°èœè°±æ•°æ®</button>
        <div id="recipeResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•4: å®Œæ•´æµç¨‹</h2>
        <button onclick="testFullFlow()">æµ‹è¯•å®Œæ•´æµç¨‹</button>
        <div id="fullResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•5: è·³è½¬åˆ°ç»“æœé¡µé¢</h2>
        <button onclick="goToResult()">è·³è½¬åˆ°recipe-result.html</button>
        <div id="jumpResult" class="result"></div>
    </div>

    <script>
        // æµ‹è¯•ç¯å¢ƒæ£€æµ‹
        function testEnvironment() {
            const result = document.getElementById('envResult');
            const hostname = window.location.hostname;
            const isStaticDeployment = hostname === 'www.forbites.store' || hostname === 'forbites.store';
            
            let html = `<div class="success">`;
            html += `<strong>å½“å‰ç¯å¢ƒä¿¡æ¯:</strong><br>`;
            html += `åŸŸå: ${hostname}<br>`;
            html += `æ˜¯å¦ä¸ºé™æ€éƒ¨ç½²: ${isStaticDeployment ? 'æ˜¯' : 'å¦'}<br>`;
            html += `å®Œæ•´URL: ${window.location.href}<br>`;
            html += `å»ºè®®ä½¿ç”¨: ${isStaticDeployment ? 'æœ¬åœ°å­˜å‚¨' : 'APIè°ƒç”¨'}`;
            html += `</div>`;
            
            result.innerHTML = html;
        }
        
        // æµ‹è¯•ç­›é€‰æ¡ä»¶
        function testFilters() {
            const result = document.getElementById('filterResult');
            
            const filters = {
                cooking_time: 2,
                is_packable: true,
                is_induction: false
            };
            
            try {
                localStorage.setItem('recipeFilters', JSON.stringify(filters));
                const retrieved = JSON.parse(localStorage.getItem('recipeFilters'));
                
                if (JSON.stringify(filters) === JSON.stringify(retrieved)) {
                    result.innerHTML = `<div class="success">âœ… ç­›é€‰æ¡ä»¶ä¿å­˜æˆåŠŸ!<br>æ•°æ®: ${JSON.stringify(filters, null, 2)}</div>`;
                } else {
                    result.innerHTML = `<div class="error">âŒ ç­›é€‰æ¡ä»¶æ•°æ®ä¸åŒ¹é…</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ ç­›é€‰æ¡ä»¶ä¿å­˜å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•æœ¬åœ°èœè°±ç”Ÿæˆ
        function testLocalRecipes() {
            const result = document.getElementById('recipeResult');
            
            const filters = {
                cooking_time: 2,
                is_packable: true,
                is_induction: false
            };
            
            const recipes = [
                {
                    id: 1,
                    name: 'çº¢çƒ§æ’éª¨',
                    description: 'ç»å…¸çš„å®¶å¸¸èœï¼Œè‚‰è´¨é²œå«©ï¼Œå‘³é“æµ“éƒ',
                    cooking_time: 90,
                    is_packable: true,
                    is_induction: true,
                    ingredients: ['æ’éª¨', 'å§œ', 'è’œ', 'æ–™é…’', 'ç”ŸæŠ½', 'è€æŠ½', 'å†°ç³–'],
                    steps: ['æ’éª¨ç„¯æ°´å»è¡€æ°´', 'é”…ä¸­æ”¾æ²¹ï¼Œçˆ†é¦™å§œè’œ', 'æ”¾å…¥æ’éª¨ç¿»ç‚’ä¸Šè‰²'],
                    tips: ['æ’éª¨ä¸€å®šè¦ç„¯æ°´ï¼Œè¿™æ ·ç‚–å‡ºæ¥çš„æ±¤æ‰ä¼šæ¸…æ¾ˆ']
                }
            ];

            const localRecipeData = {
                recipes: recipes,
                filters: filters,
                generated_at: new Date().toISOString(),
                source: 'local'
            };
            
            try {
                localStorage.setItem('localRecipeData', JSON.stringify(localRecipeData));
                const retrieved = JSON.parse(localStorage.getItem('localRecipeData'));
                
                if (JSON.stringify(localRecipeData) === JSON.stringify(retrieved)) {
                    result.innerHTML = `<div class="success">âœ… æœ¬åœ°èœè°±æ•°æ®ç”ŸæˆæˆåŠŸ!<br>èœè°±æ•°é‡: ${recipes.length}<br>ç”Ÿæˆæ—¶é—´: ${localRecipeData.generated_at}</div>`;
                } else {
                    result.innerHTML = `<div class="error">âŒ æœ¬åœ°èœè°±æ•°æ®ä¸åŒ¹é…</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ æœ¬åœ°èœè°±ç”Ÿæˆå¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•å®Œæ•´æµç¨‹
        function testFullFlow() {
            const result = document.getElementById('fullResult');
            const steps = [];
            
            // æ­¥éª¤1: ç¯å¢ƒæ£€æµ‹
            const hostname = window.location.hostname;
            const isStaticDeployment = hostname === 'www.forbites.store' || hostname === 'forbites.store';
            steps.push(`âœ… ç¯å¢ƒæ£€æµ‹: ${isStaticDeployment ? 'é™æ€éƒ¨ç½²' : 'å…¶ä»–ç¯å¢ƒ'}`);
            
            // æ­¥éª¤2: ä¿å­˜ç­›é€‰æ¡ä»¶
            const filters = {
                cooking_time: 2,
                is_packable: true,
                is_induction: false
            };
            
            try {
                localStorage.setItem('recipeFilters', JSON.stringify(filters));
                steps.push('âœ… ç­›é€‰æ¡ä»¶ä¿å­˜æˆåŠŸ');
            } catch (error) {
                steps.push(`âŒ ç­›é€‰æ¡ä»¶ä¿å­˜å¤±è´¥: ${error.message}`);
            }
            
            // æ­¥éª¤3: ç”Ÿæˆæœ¬åœ°èœè°±
            const recipes = [
                {
                    id: 1,
                    name: 'çº¢çƒ§æ’éª¨',
                    description: 'ç»å…¸çš„å®¶å¸¸èœ',
                    cooking_time: 90,
                    is_packable: true,
                    is_induction: true,
                    ingredients: ['æ’éª¨', 'å§œ', 'è’œ'],
                    steps: ['æ’éª¨ç„¯æ°´å»è¡€æ°´'],
                    tips: ['æ’éª¨ä¸€å®šè¦ç„¯æ°´']
                }
            ];
            
            const localRecipeData = {
                recipes: recipes,
                filters: filters,
                generated_at: new Date().toISOString(),
                source: 'local'
            };
            
            try {
                localStorage.setItem('localRecipeData', JSON.stringify(localRecipeData));
                steps.push('âœ… æœ¬åœ°èœè°±æ•°æ®ç”ŸæˆæˆåŠŸ');
            } catch (error) {
                steps.push(`âŒ æœ¬åœ°èœè°±ç”Ÿæˆå¤±è´¥: ${error.message}`);
            }
            
            // æ­¥éª¤4: éªŒè¯æ•°æ®
            try {
                const savedFilters = JSON.parse(localStorage.getItem('recipeFilters'));
                const savedRecipes = JSON.parse(localStorage.getItem('localRecipeData'));
                
                if (savedFilters && savedRecipes) {
                    steps.push('âœ… æ•°æ®éªŒè¯æˆåŠŸ');
                } else {
                    steps.push('âŒ æ•°æ®éªŒè¯å¤±è´¥');
                }
            } catch (error) {
                steps.push(`âŒ æ•°æ®éªŒè¯å¤±è´¥: ${error.message}`);
            }
            
            result.innerHTML = `<div class="success"><h4>å®Œæ•´æµç¨‹æµ‹è¯•ç»“æœ:</h4>${steps.map(step => `<div>${step}</div>`).join('')}</div>`;
        }
        
        // è·³è½¬åˆ°ç»“æœé¡µé¢
        function goToResult() {
            const result = document.getElementById('jumpResult');
            
            // ç¡®ä¿æœ‰æµ‹è¯•æ•°æ®
            if (!localStorage.getItem('recipeFilters')) {
                testFilters();
            }
            if (!localStorage.getItem('localRecipeData')) {
                testLocalRecipes();
            }
            
            result.innerHTML = `<div class="success">âœ… å‡†å¤‡è·³è½¬åˆ°ç»“æœé¡µé¢...<br>3ç§’åè‡ªåŠ¨è·³è½¬</div>`;
            
            setTimeout(() => {
                window.location.href = 'recipe-result.html';
            }, 3000);
        }
    </script>
</body>
</html> 